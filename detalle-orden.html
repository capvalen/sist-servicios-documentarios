<!DOCTYPE html>
<html lang="es">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Intranet Grupo Cimal Perú</title>
	<link rel="stylesheet" href="css/estilos.css">
	<link rel="icon" href="img/favicon.png" sizes="32x32" /> <!-- favicon -->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
	<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
	<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

</head>
<body>
	<div class="row" id="app">
		
		<section class="col col-md-3 p-4 " id="menu">
			<div class="mx-auto w-75 mb-3"><img src="img/logo.jpeg" class="img-fluid"></div>
			<div class="list-group">
				<a href="principal.html" type="button" class="list-group-item list-group-item-action" aria-current="true">
					<i class="bi bi-caret-right-fill"></i> <span class="icono"><i class="bi bi-house"></i> Inicio</span> 
				</a>
				<a href="contratos.html" type="button" class="list-group-item list-group-item-action">
					<i class="bi bi-caret-right-fill"></i> <span class="icono"><i class="bi bi-file-medical"></i> Contratos</span> 
				</a>
				<a href="pagos.html" type="button" class="list-group-item list-group-item-action">
					<i class="bi bi-caret-right-fill"></i> <span class="icono"><i class="bi bi-wallet2"></i> Pagos y detracciones</span> 
				</a>
				<a href="clientes.html" type="button" class="list-group-item list-group-item-action">
					<i class="bi bi-caret-right-fill"></i> <span class="icono"><i class="bi bi-people"></i> Clientes</span> 
				</a>
				<a href="compras.html" type="button" class="list-group-item list-group-item-action">
					<i class="bi bi-caret-right-fill"></i> <span class="icono"><i class="bi bi-piggy-bank"></i> Compras</span> 
				</a>
				<a href="ventas.html" type="button" class="list-group-item list-group-item-action">
					<i class="bi bi-caret-right-fill"></i> <span class="icono"><i class="bi bi-cart"></i> Ventas</span> 
				</a>
				<a href="cuentas-por-cobrar.html" type="button" class="list-group-item list-group-item-action">
					<i class="bi bi-caret-right-fill"></i> <span class="icono"><i class="bi bi-bag"></i> Cuentas por cobrar</span> 
				</a>
				<a href="cuentas-por-pagar.html" type="button" class="list-group-item list-group-item-action">
					<i class="bi bi-caret-right-fill"></i> <span class="icono"><i class="bi bi-bag"></i> Cuentas por pagar</span> 
				</a>
				<a href="usuarios.html" type="button" class="list-group-item list-group-item-action">
					<i class="bi bi-caret-right-fill"></i> <span class="icono"><i class="bi bi-people"></i> Usuarios</span> 
				</a>
				<a href="reportes.html" type="button" class="list-group-item list-group-item-action">
					<i class="bi bi-caret-right-fill"></i> <span class="icono"><i class="bi bi-file-bar-graph"></i> Reportes</span> 
				</a>
				<a href="perfil.html" type="button" class="list-group-item list-group-item-action">
					<i class="bi bi-caret-right-fill"></i> <span class="icono"><i class="bi bi-gear-fill"></i> Mi perfil</span> 
				</a>
			</div>
		</section>

		<section v-if="sinAcceso" class="col col-md-9 container my-3 p-4 border-start ">
			<p class="fs-3">Contenido restringido</p>
			
			<p>Ud. No tiene acceso, solicite a los administradores el acceso</p>
			<a href="javascript:void(0);" class="text-decoration-none" onclick="history.back();"><i class="bi bi-arrow-left-short"></i> Volver</a>
		</section>

		<section v-if="!sinAcceso" class="col col-md-9 container mb-3 p-4 pt-3 border-start " >
			<div class="d-flex justify-content-between me-5">
				<p class="mb-0 text-muted"><small><strong>Usuario actual:</strong> <span class="text-capitalize">{{nombreCompletoSesion()}}</span></small></p>
				<p class="mb-0 text-muted"><small><strong>Nivel: </strong> 
				<span v-if="verificarAcceso()">Administrador</span><span v-else>Colaborador</span> <a class="text-decoration-none" href="salir.html"><i class="bi bi-door-open"></i> Cerrar sesión</a></small></p>
			</div>
			<hr class="opacity-25">
			<h1 class="text-start">Registro de Cliente: <span class="text-capitalize">{{servicio.razon}}</span></h1>
			<div class="card mb-3">
				<div class="card-body">
					<h5 class="fw-bold">Datos de cabecera</h5>
					<div class="row">
						<div class="col-4 my-2">
							<label class="fw-bold">N° orden de compra</label>
							<input type="text" class="form-control" v-model="servicio.ruc">
						</div>
					</div>
					<div class="row row-cols-md-3">
						<div class="col my-2">
							<label class="fw-bold">R.U.C.</label>
							<input type="text" class="form-control" v-model="servicio.ruc">
						</div>
						<div class="col my-2">
							<label class="fw-bold">Razón social</label>
							<input type="text" class="form-control" v-model="servicio.razon">
						</div>
						<div class="col my-2">
							<label class="fw-bold">Dirección</label>
							<input type="text" class="form-control" v-model="servicio.direccion">
						</div>
						<div class="col my-2">
							<label class="fw-bold">Teléfono</label>
							<input type="text" class="form-control" v-model="servicio.celular">
						</div>
						<div class="col my-2">
							<label class="fw-bold">Ciudad</label>
							<input type="text" class="form-control" v-model="servicio.ciudad">
						</div>
						<div class="col my-2">
							<label class="fw-bold">País</label>
							<input type="text" class="form-control" v-model="servicio.pais">
						</div>
						<div class="col my-2">
							<label class="fw-bold">Castilla DTE</label>
							<input type="text" class="form-control" v-model="servicio.casilla">
						</div>
						<div class="col my-2">
							<label class="fw-bold">Enviar a</label>
							<input type="text" class="form-control" v-model="servicio.enviar">
						</div>
						<div class="col my-2">
							<label class="fw-bold">Dirección a</label>
							<input type="text" class="form-control" v-model="servicio.direccionDestino">
						</div>
						<div class="col my-2">
							<label class="fw-bold">Ciudad</label>
							<input type="text" class="form-control" v-model="servicio.ciudadDestino">
						</div>
						<div class="col my-2">
							<label class="fw-bold">País</label>
							<input type="text" class="form-control" v-model="servicio.paisDestino">
						</div>
						<div class="col my-2">
							<label class="fw-bold">Centro almacén</label>
							<input type="text" class="form-control" v-model="servicio.almacen">
						</div>
						<div class="col my-2">
							<label class="fw-bold">Lugar de entrega</label>
							<input type="text" class="form-control" v-model="servicio.lugar">
						</div>
						<div class="col my-2">
							<label class="fw-bold">Dirección de entrega</label>
							<input type="text" class="form-control" v-model="servicio.direccionEntrega">
						</div>
						<div class="col my-2">
							<label class="fw-bold">Contacto</label>
							<input type="text" class="form-control" v-model="servicio.contacto">
						</div>
					</div>
				</div>
			</div>

			<div class="card my-3">
				<div class="card-body">
					<h5 class="fw-bold">Información del proveedor</h5>
					<div class="row row-cols-4">
						<div class="col my-2">
							<label class="fw-bold">R.U.C.</label>
							<input type="text" class="form-control" v-model="proveedor.ruc">
						</div>
						<div class="col my-2">
							<label class="fw-bold">Razón social</label>
							<input type="text" class="form-control" v-model="proveedor.razon">
						</div>
						<div class="col my-2">
							<label class="fw-bold">Dirección a</label>
							<input type="text" class="form-control" v-model="proveedor.direccionDestino">
						</div>
						<div class="col my-2">
							<label class="fw-bold">Teléfono</label>
							<input type="text" class="form-control" v-model="proveedor.celular">
						</div>
						<div class="col my-2">
							<label class="fw-bold">Zip Code</label>
							<input type="text" class="form-control" v-model="proveedor.zip">
						</div>
						<div class="col my-2">
							<label class="fw-bold">Atención</label>
							<input type="text" class="form-control" v-model="proveedor.atencion">
						</div>
						<div class="col my-2">
							<label class="fw-bold">Mail</label>
							<input type="text" class="form-control" v-model="proveedor.correo">
						</div>
						<div class="col my-2">
							<label class="fw-bold">Fecha de emisión</label>
							<input type="date" class="form-control" v-model="proveedor.emision">
						</div>
						<div class="col my-2">
							<label class="fw-bold">Forma de pago</label>
							<input type="number" class="form-control" v-model="proveedor.diasPago">
						</div>
						<div class="col my-2">
							<label class="fw-bold">Referencia</label>
							<input type="text" class="form-control" v-model="proveedor.referencia">
						</div>
						<div class="col my-2">
							<label class="fw-bold">Tipo de moneda</label>
							<select name="" id="sltMoneda" class="form-select">
								<option value="1">Soles</option>
								<option value="2">Dólares</option>
							</select>
						</div>
						<div class="col my-2">
							<label class="fw-bold">Incoterm</label>
							<input type="text" class="form-control" v-model="proveedor.incoterm">
						</div>
					</div>
				</div>
			</div>

			<div class="card my-3">
				<div class="card-body">
					<div class="d-flex justify-content-between align-items-center">
						<h5 class="my-3 fw-bold">Servicios de la Órden</h5>
						<div><button class="btn btn-sm btn-outline-success" @click="agregarFila()"><i class="bi bi-plus-lg"></i> Agregar fila</button></div>
					</div>

					<div class="table-responsive">
						<table class="table table-hover">
							<thead>
								<th>N°</th>
								<th>SOLPED</th>
								<th>Pos.</th>
								<th>Cod. ESPE.</th>
								<th>Descripción general</th>
								<th>Observaciones</th>
								<th>F. Entr.</th>
								<th>Cantidad</th>
								<th>U. Med.</th>
								<th>P. Unit.</th>
								<th>P. Total</th>
							</thead>
							<tbody>
								<tr v-for="(producto, index) in productos">
									<td>{{index+1}}</td>
									<td>
										<input type="text" class="form-control" v-model="{{producto.solped}}">
									</td>
									<td>
										<input type="text" class="form-control" v-model="{{producto.pos}}">
									</td>
									<td>
										<input type="text" class="form-control" v-model="{{producto.codigo}}">
									</td>
									<td>
										<input type="text" class="form-control" v-model="{{producto.descripcion}}">
									</td>
									<td>
										<input type="text" class="form-control" v-model="{{producto.observaciones}}">
									</td>
									<td>
										<input type="date" class="form-control" v-model="{{producto.fecha}}">
									</td>
									<td>
										<input type="number" class="form-control" v-model="{{producto.cantidad}}">
									</td>
									<td>
										<input type="text" class="form-control" v-model="{{producto.medida}}">
									</td>
									<td>
										<input type="number" class="form-control" v-model="{{producto.precioUnitario}}">
									</td>
									<td>
										<input type="number" class="form-control" v-model="{{producto.cantidad * producto.precioUnitario}}">
									</td>
								</tr>
							</tbody>
						</table>
					</div>

				</div>
			</div>
		</section>
	</div>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.30.1/moment.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.30.1/moment-with-locales.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
	<script>
		const { createApp, ref, onMounted, computed, reactive } = Vue
	
		const app = createApp({
			setup() {
				const servidor = 'http://localhost/documentos-cimal/api/'
				let idServicio = ref(-1)
				const sinAcceso = ref(true)
				const usuarios = ref([])
				const servicio = ref([])
				const proveedor = ref([])
				const productos = reactive([])
				const esNuevo = ref(true)
				
				
				onMounted(()=>{
					if(!localStorage.getItem('idUsuario')) window.location = 'index.html'
					else{
						const url = new URL(window.location.href);
						idServicio = url.searchParams.get('id');
						const modo = url.searchParams.get('modo');
						
						esNuevo.value = (modo == 'editar') ? false:true
						if(localStorage.getItem('nivel')==1){
							sinAcceso.value = false
							//pedirDatos()
						}else{
							//pedir quien accede
							axios.post(servidor + 'Cliente.php',{
								pedir:'listarID',
								idUsuario: localStorage.getItem('idUsuario'),
								id: idServicio
							}).then(res=>{
								console.log(res.data)
								if(res.data=='noAccess'){
									sinAcceso.value = true
								}
								else{
									sinAcceso.value=false
									servicio.value = res.data.cliente
								}
							})
						}
					}
				})

				function pedirDatos(){
					axios.post(servidor + 'Cliente.php',{
						pedir:'listarID',
						id: idServicio
					}).then(res=> {
						servicio.value = res.data.cliente
					})

					axios.post(servidor + 'Usuario.php',{
						pedir:'listar'
					}).then(res=> {
						usuarios.value = res.data
					})
				}

				const calcularTotal = (producto) => {
					return parseFloat(producto.cantidad * producto.precioUnitario).toFixed(2);
				};
			
				function agregarFila(){
					productos.push({
						cantidad: 1, precioUnitario:0
					})
				}
				
				function fechaLatam(fecha){
					if(fecha) return moment(fecha).format('DD/MM/YYYY')
				}
				function fechaLatamLargo(fecha){
					moment.locale('es')
					if(fecha) return moment(fecha).format('dddd, DD [de] MMMM [de] YYYY')
				}

				function verificarAcceso(){
					if(localStorage.getItem('nivel')=='1') return true
					else return false
				}
				function nombreCompletoSesion(){ return localStorage.getItem('nombreUsuario') }

				return {
					servidor, servicio, fechaLatamLargo, fechaLatam, usuarios, sinAcceso, verificarAcceso, nombreCompletoSesion,
					esNuevo, proveedor, productos, agregarFila, calcularTotal
				}
			}
		}).mount('#app')
	</script>
</body>
</html>